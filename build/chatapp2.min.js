/*! <ChatApp> 25-02-2014 */
var app=angular.module("ChatApp",["ngRoute"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"templates/home.html",controller:"LoginController"}).when("/rooms/:roomName/",{templateUrl:"templates/rooms.html",controller:"RoomController"}).when("/room/:roomName",{templateUrl:"templates/room.html",controller:"RoomController"}).otherwise({redirectTo:"/"})}]),app.factory("SocketService",["$http",function(){var a,b="";return{setConnected:function(b){a=b},setUsername:function(a){b=a},getUsername:function(){return b},getSocket:function(){return a}}}]),app.controller("LoginController",["$scope","$location","SocketService",function(a,b){a.username="",a.message="";var c=io.connect("http://localhost:8080");a.connect=function(){c&&c.emit("adduser",a.username,function(c){c?b.path("/rooms/lobby"):a.message="Your name is taken, please choose another",a.$apply()})}}]),app.controller("RoomController",["$scope","$location","$routeParams","SocketService",function(a,b,c,d){a.roomName=c.roomName,a.currentMessage="",a.rooms=[],a.username="";{var e=d.getSocket();c.id}e&&(e.emit("joinroom",{room:a.roomName,pass:""},function(){}),e.on("updatechat",function(b,c){console.log(c),a.messages=c,a.$apply()}),e.on("updateusers",function(b,c){b===a.roomName&&(a.users=c,a.$apply())}),e.on("roomlist",function(b,c){a.rooms=b,a.users=c})),a.createChannel=function(){e&&(e.emit("adduser",a.username,function(){}),e.emit("joinroom",{room:a.roomName,pass:""},function(c){c&&(d.setConnected(e),d.setUsername(a.username),b.path("/room/"+a.roomName),a.$apply())}))},a.leaveChannel=function(){b.path("/rooms/lobby")},a.Dis=function(){e.emit("disconnect",function(){}),b.path("/#/")},a.Kick=function(){},a.Ban=function(){},a.send=function(){e&&(console.log("I sent a message to "+a.roomName+": "+a.currentMessage),e.emit("sendmsg",{roomName:a.roomName,msg:a.currentMessage}),a.currentMessage="")},a.keyPress=function(b){13===b.keyCode&&a.send()}}]);